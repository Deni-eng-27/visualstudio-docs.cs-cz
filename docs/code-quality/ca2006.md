---
title: 'CA2006: Použijte SafeHandle pro zapouzdření nativních prostředků'
ms.date: 11/04/2016
ms.topic: reference
f1_keywords:
- CA2006
- UseSafeHandleToEncapsulateNativeResources
helpviewer_keywords:
- UseSafeHandleToEncapsulateNativeResources
- CA2006
ms.assetid: a71950bd-bcc1-463d-b1f2-5233bc451456
author: mikejo5000
ms.author: mikejo
manager: jillfra
ms.workload:
- cplusplus
ms.openlocfilehash: 7c75f48c56b21d50e08e9864557318d7f110edae
ms.sourcegitcommit: d233ca00ad45e50cf62cca0d0b95dc69f0a87ad6
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 01/01/2020
ms.locfileid: "75584631"
---
# <a name="ca2006-use-safehandle-to-encapsulate-native-resources"></a>CA2006: Použijte SafeHandle pro zapouzdření nativních prostředků

|||
|-|-|
|TypeName|UseSafeHandleToEncapsulateNativeResources|
|CheckId|CA2006|
|Kategorie|Microsoft.Reliability|
|Zásadní změna|Nenarušující|

## <a name="cause"></a>příčina

Spravovaný kód používá <xref:System.IntPtr> pro přístup k nativním prostředkům.

## <a name="rule-description"></a>Popis pravidla

Použití `IntPtr` ve spravovaném kódu může poukazovat na potenciální problém zabezpečení a spolehlivosti. Všechna použití `IntPtr` musí být přezkoumána, aby bylo možné určit, zda je na svém místě vyžadováno použití <xref:System.Runtime.InteropServices.SafeHandle> nebo podobná technologie. K problémům dojde, pokud `IntPtr` představuje nějaký nativní prostředek, jako je například paměť, popisovač souboru nebo soket, který je spravovaným kódem považován za vlastní. Pokud spravovaný kód vlastní prostředek, musí také uvolnit nativní prostředky, které jsou k němu přidruženy, protože v důsledku selhání by to způsobilo únik prostředků.

V takových scénářích budou k dispozici také problémy se zabezpečením a spolehlivostí, pokud je `IntPtr` přístup s více vlákny a způsob uvolnění prostředku, který je reprezentován `IntPtr`. Tyto problémy zahrnují recyklaci `IntPtr` hodnoty ve verzi prostředků, zatímco se souběžné používání prostředků provádí v jiném vlákně. To může způsobit časování časování, ve kterém jedno vlákno může číst nebo zapisovat data přidružená k chybnému prostředku. Například pokud váš typ uchovává popisovač operačního systému jako `IntPtr` a umožňuje uživatelům volat jak **Zavřít** , tak i jiné metody, které používají tento popisovač současně a bez určitého druhu synchronizace, má váš kód problém s recyklací popisovače.

Tento problém recyklace obslužné rutiny může způsobit poškození dat a často ohrožení zabezpečení. `SafeHandle` a jeho třída na stejné úrovni <xref:System.Runtime.InteropServices.CriticalHandle> poskytuje mechanismus pro zapouzdření nativního popisovače do prostředku tak, aby se takové problémy s vlákny mohly vyhnout. Kromě toho můžete použít `SafeHandle` a jeho třídu na stejné úrovni `CriticalHandle` pro jiné problémy s vlákny, například k pečlivému řízení životnosti spravovaných objektů, které obsahují kopii nativního popisovače přes volání do nativních metod. V této situaci můžete často odebrat volání `GC.KeepAlive`. Nároky na výkon, které jste se vám zaznamenali při použití `SafeHandle` a na nižší úrovni `CriticalHandle`, se často můžou snižovat prostřednictvím pečlivého návrhu.

## <a name="how-to-fix-violations"></a>Jak opravit porušení

Převeďte `IntPtr` využití na `SafeHandle` pro bezpečnou správu přístupu k nativním prostředkům. Příklady najdete v článku informace o <xref:System.Runtime.InteropServices.SafeHandle>.

## <a name="when-to-suppress-warnings"></a>Kdy potlačit upozornění

Toto upozornění potlačit.

## <a name="see-also"></a>Viz také:

- <xref:System.IDisposable>
