---
title: 'CA5381: Zajistěte, aby se certifikáty nepřidaly do kořenového úložiště.'
description: Obsahuje informace o CA5381 pravidla analýzy kódu, včetně příčin, jak opravit porušení a kdy je potlačit.
ms.date: 08/14/2019
ms.topic: reference
author: filipsebesta
ms.author: filipse
manager: jillfra
dev_langs:
- CSharp
ms.workload:
- multiple
f1_keywords:
- CA5381
- DoNotInstallRootCert
ms.openlocfilehash: bc17c9f70971894d6133c305f676e8df4091c258
ms.sourcegitcommit: c222052906362bf1a3762ec4d4623170e4e06702
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 12/04/2019
ms.locfileid: "74809818"
---
# <a name="ca5381-ensure-certificates-are-not-added-to-root-store"></a>CA5381: Zajistěte, aby se certifikáty nepřidaly do kořenového úložiště.

|||
|-|-|
|TypeName|DoNotInstallRootCert|
|CheckId|CA5381|
|Kategorie|Microsoft.Security|
|Zásadní změna|Nenarušující|

## <a name="cause"></a>příčina

Přidání certifikátů do důvěryhodných kořenových certifikátů operačního systému zvyšuje riziko legitimizing nedůvěryhodné certifikační autority.

Ve výchozím nastavení toto pravidlo analyzuje celý základ kódu, ale je možné ho [nakonfigurovat](#configurability).

## <a name="rule-description"></a>Popis pravidla

Toto pravidlo detekuje kód, který potenciálně přidá certifikát do úložiště certifikátů důvěryhodných kořenových certifikačních autorit. Ve výchozím nastavení je úložiště certifikátů důvěryhodných kořenových certifikačních autorit nakonfigurováno se sadou veřejných certifikačních autorit (CA), které splnily požadavky programu Microsoft Root Certificate Program. Vzhledem k tomu, že všechny důvěryhodné kořenové certifikační autority můžou vystavovat certifikáty pro libovolnou doménu, může útočník vybrat slabou nebo možné převéstou certifikační autoritu, kterou sami nainstalujete, abyste mohli cílit na útok – a jedna zranitelná, škodlivá nebo možné převéstá certifikační autorita podrušují zabezpečení celého systému.

## <a name="how-to-fix-violations"></a>Jak opravit porušení

Neinstalujte certifikáty do úložiště certifikátů důvěryhodných kořenových certifikačních autorit.

## <a name="when-to-suppress-warnings"></a>Kdy potlačit upozornění

Toto pravidlo se nedoporučuje potlačit.

## <a name="configurability"></a>Konfigurovatelnost

Pokud toto pravidlo spouštíte z [analyzátorů FxCop](install-fxcop-analyzers.md) (a ne pomocí starší verze analýzy), je toto pravidlo konfigurovatelné.

### <a name="excluded-symbol-names"></a>Vyloučené názvy symbolů

Můžete nakonfigurovat, které části vašeho základu kódu budou vyloučeny z analýzy. Například chcete-li určit, že pravidlo by nemělo běžet na žádný kód v rámci typů s názvem `MyType`, přidejte do souboru. editorconfig v projektu následující dvojici klíč-hodnota:

```ini
dotnet_code_quality.CA5381.excluded_symbol_names = MyType
```

Povolené formáty názvů symbolů v hodnotě možnosti (oddělené |):
  - Pouze název symbolu (včetně všech symbolů s názvem, bez ohledu na obsahující typ nebo obor názvů)
  - Plně kvalifikované názvy ve [formátu ID dokumentace k](https://github.com/dotnet/csharplang/blob/master/spec/documentation-comments.md#id-string-format)symbolu. Každý název symbolu vyžaduje předponu typu symbolu, jako je například "M:" prefix pro metody, předpona "T:" pro typy, předpona "N:" pro obory názvů atd.
  - `.ctor` pro konstruktory a `.cctor` pro statické konstruktory

Příklady:

| Hodnota možnosti | Přehled |
| --- | --- |
|`dotnet_code_quality.CA5381.excluded_symbol_names = MyType` | Odpovídá všem symbolům s názvem ' MyType ' v kompilaci
|`dotnet_code_quality.CA5381.excluded_symbol_names = MyType1|MyType2` | Odpovídá všem symbolům s názvem ' MyType1 ' nebo ' MyType2 ' v kompilaci
|`dotnet_code_quality.CA5381.excluded_symbol_names = M:NS.MyType.MyMethod(ParamType)` | Odpovídá konkrétní metodě ' MyMethod ' s daným plně kvalifikovaným podpisem
|`dotnet_code_quality.CA5381.excluded_symbol_names = M:NS1.MyType1.MyMethod1(ParamType)|M:NS2.MyType2.MyMethod2(ParamType)` | Odpovídá specifickým metodám ' MyMethod1 ' a ' MyMethod2 ' s odpovídajícím plně kvalifikovaným podpisem

Všechny tyto možnosti můžete nakonfigurovat jenom pro toto pravidlo, pro všechna pravidla nebo pro všechna pravidla v této kategorii (zabezpečení). Další informace najdete v tématu [Konfigurace analyzátorů FxCop](configure-fxcop-analyzers.md).

## <a name="pseudo-code-examples"></a>Příklady kódu pseudo

### <a name="violation"></a>Selhání

Následující ukázka pseudo kódu znázorňuje vzor zjištěný tímto pravidlem.

```csharp
using System;
using System.Security.Cryptography.X509Certificates;

class TestClass
{
    public void TestMethod()
    {
        var storeName = StoreName.Root;
        Random r = new Random();

        if (r.Next(6) == 4)
        {
            storeName = StoreName.My;
        }

        var x509Store = new X509Store(storeName);
        x509Store.Add(new X509Certificate2());
    }
}
```

### <a name="solution"></a>Řešení

```csharp
using System.Security.Cryptography.X509Certificates;

class TestClass
{
    public void TestMethod()
    {
        var storeName = StoreName.My;
        var x509Store = new X509Store(storeName);
        x509Store.Add(new X509Certificate2());
    }
}
```
